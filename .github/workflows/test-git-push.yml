name: Test Git Push Functionality

on:
  workflow_dispatch:
    # Allow manual triggering only

jobs:
  test-git-push:
    runs-on: ubuntu-latest
    permissions:
      contents: write  # Required to push commits
      actions: read   # Required to read workflow files
    
    steps:
    - name: Checkout repository
      uses: actions/checkout@v4
      with:
        fetch-depth: 0  # Fetch full history for better git operations
      
    - name: Test file creation and git push
      run: |
        # Configure git
        git config --local user.email "action@github.com"
        git config --local user.name "GitHub Action Test Bot"
        
        # Create a test file to simulate data creation
        mkdir -p data
        echo '{"test": true, "timestamp": "'$(date -u +"%Y-%m-%d %H:%M:%S UTC")'"}' > data/test.json
        
        # Check if test file was created (simulates processing happened)
        if [ -f "data/test.json" ]; then
          echo "📊 Test file created, committing changes"
          
          # Add data files
          git add data/
          
          # Debug info
          echo "📁 Files in data directory:"
          ls -la data/
          
          # Commit and push the changes
          git commit -m "🧪 Test commit - $(date -u +"%Y-%m-%d %H:%M UTC")

          This is a test to verify git push functionality works correctly.
          
          🤖 Generated by test workflow"
          
          echo "📤 Pushing changes to repository..."
          git push
          
          echo "✅ Git push test successful!"
        else
          echo "❌ Test file not created"
          exit 1
        fi
        
    - name: Cleanup test file
      run: |
        # Remove test file and commit cleanup
        git rm data/test.json
        git commit -m "🧹 Cleanup test file"
        git push
        echo "🧹 Test cleanup completed"